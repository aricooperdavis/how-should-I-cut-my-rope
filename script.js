let regions=["derbyshire","scotland","yorkshire"];function removeRope(t){t.target.parentNode.remove()}function addRope(t){let e=ropeInput.cloneNode(!0);e.lastChild.disabled=!1,e.firstChild.value="",e.firstChild.onkeydown=handleTabs,addButton.parentNode.insertBefore(e,t.target??t);for(let t of document.getElementsByClassName("rope"))t.lastChild.onclick=removeRope;return e}let addButton=document.getElementById("add");function handleTabs(t){if("Tab"==t.code){let e=addRope(t.target.parentNode.nextElementSibling);t.preventDefault(),e.firstChild.focus()}}addButton.onclick=addRope;let ropeInput=document.getElementsByClassName("rope")[0];ropeInput.onkeydown=handleTabs;let resultsGraph=document.getElementById("results-graph"),chart=new Chart(resultsGraph,{type:"scatter",data:{datasets:[{label:"Options",labels:[""],data:[{}]}]},options:{scales:{x:{title:{display:!0,text:"Efficiency"}},y:{title:{display:!0,text:"Possible trips"}}},plugins:{tooltip:{callbacks:{label:function(t){return`Efficiency: ${t.parsed.x}, Trips: ${t.parsed.y} ${t.dataset.labels[t.dataIndex]}`}}}},animation:!1}}),chart_checkbox=document.getElementById("graph"),pf_checkbox=document.getElementById("paretofrontier"),tableData=document.getElementById("results-data"),resetButton=document.getElementById("reset");resetButton.onclick=function(){for(let t of document.querySelectorAll(".rope"))t.lastChild.disabled?t.firstChild.value="":t.remove();Array.from(document.getElementsByClassName("cut")).forEach((t=>t.checked=!1)),chart_checkbox.checked=!0,pf_checkbox.checked=!1,tableData.innerHTML="",chart.data.datasets[0].data.length=1,chart.data.datasets[0].labels.length=1,chart.update()};let spinner=document.getElementById("spinner"),results_table=document.getElementById("results-table"),goButton=document.getElementById("go");function scoreRopes(t,e){let a=0,n=0;for(let l=0;l<t.length;l++){let s=t[l];if(s.length>e.length||Math.max(...s)>Math.max(...e))continue;let o=0,r=0,c=0;for(;r<s.length&&c<e.length;)if(s[r]>e[c])c++;else{let t=s[r]/e[c];r++,o+=(t-o)/r,c++}r<s.length||(a++,n+=(o-n)/a)}return[a,n.toFixed(3)]}function plotOption(t,e,a){chart.data.datasets[0].labels.push(a),chart.data.datasets[0].data.push({x:t,y:e})}function*cartesian(t,...e){const a=e.length>0?cartesian(...e):[[]];for(let e of a)for(let a of t)yield[a,...e]}function combos(t){const e=[[],[[1]],[[2],[1,1]]];return[...new Set([...function t(a){var n,l,s=a-1;if(e[a])return e[a];const o=a%2?[[a]]:[[a],[a>>1,a>>1]];for(;s>a-s;){n=a-s;for(const e of t(s--)){const t=[];l=!0;for(const a of e)a>n||!l?t.push(a):(l=!1,t.push(n,a));l&&t.push(n),o.push(t)}}return e[a]=o}(t).map((t=>t.join(",")))])].map((t=>t.split(",").map((t=>parseInt(t)))))}goButton.onclick=function(){spinner.className="spinner",tableData.innerHTML="",chart.data.datasets[0].data.length=1,chart.data.datasets[0].labels.length=1,chart.update();let t=document.getElementById("resolution").value,e=[],a=[];for(let t of document.getElementsByClassName("rope")){let n=parseInt(t.firstChild.value);n&&(t.children[1].lastChild.checked?a.push(n):e.push(n))}e.sort(((t,e)=>t>e)),Promise.all(regions.map((t=>fetch(`https://raw.githubusercontent.com/aricooperdavis/what-can-I-rig/main/pitchlengths/${t}.txt`).then((t=>t.text()))))).then((n=>{trips=n.join("").split("\n").filter((t=>!(t.startsWith("#")|t.length<3))).map((t=>(t.includes("[")?t.split(",").slice(3):t.split(",").slice(1)).map((t=>parseInt(t))).sort(((t,e)=>t>e)))).sort(((t,e)=>t.length<e.length)),document.getElementById("results-table-possible-trips").textContent=`Possible trips (of ${trips.length})`,all_cuts=[],a.forEach((e=>{let a=combos(Math.floor(e/t)).map((e=>e.map((e=>e*t))));all_cuts.push(a)}));let l=[];if(0==all_cuts.length){let[t,a]=scoreRopes(trips,e);l.push([t,a,e])}else{let t=cartesian(...all_cuts);for(let a of t){let t=[...e,...a].flat().sort(((t,e)=>t>e)),[n,s]=scoreRopes(trips,t);l.push([n,s,a])}}l=new Set(l.map(JSON.stringify)),l=Array.from(l).map(JSON.parse),pf_checkbox.checked&&(l=getParetoFrontier(l));for(let t=0;t<l.length;t++){let e=l[t],a=`<tr><td>${JSON.stringify(e[2])}</td><td>${e[0]}</td><td>${e[1]}</td></tr>`;tableData.insertAdjacentHTML("beforeend",a),plotOption(e[1],e[0],JSON.stringify(e[2]))}})).then((()=>{spinner.className="spinner--hidden",chart_checkbox.checked&&chart.update()}))};